<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ëŠ¥ë ¥ ê²°ê³¼ - ë‚˜ë¬´ ê½ƒ í”¼ìš°ê¸°</title>
<style>
body {
  margin: 0;
  background: url('background1.jpg') no-repeat center center fixed;
  background-size: cover;
  color: #ff85b3;
  font-family: Pretendard, sans-serif;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  position: relative;
}

body::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.55);
  z-index: -1;
}

#tree-container {
  position: relative;
  width: 70vw;
  max-width: 600px;
  height: 80vh;
  max-height: 800px;
  background: url('tree.png') no-repeat bottom center;
  background-size: contain;
}

#title {
  color: #ff4d9e;
  font-size: 1.2rem;
  margin: 0;
  position: absolute;
  bottom: 95%;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 600px;
  height: 3.5em;         /* ğŸ”¥ ì „ì²´ ì˜ì—­ ê³ ì • */
  text-align: center;
  font-weight: 400;
}

#title span {
  display: block;        /* ì¤„ ë‹¨ìœ„ ê³ ì • */
  height: 1.5em;        /* ì¤„ ë†’ì´ ê³ ì • */
}




#subtitle {
  color: #ff85b3; 
  font-size: 0.8rem; 
  position: absolute; 
  top: calc(-1% + 10px); 
  left: 50%; 
  transform: translateX(-50%); 
  white-space: nowrap;
}

#flower-layer {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.flower {
  position: absolute;
  width: 5px;
  height: 5px;
  opacity: 0;
  border-radius: 50%;
  background: #FF7DAF;
  pointer-events: none;
  filter: none;
}

@keyframes sway {
  0% { transform: translateX(0) rotate(0deg); }
  25% { transform: translateX(-2px) rotate(-5deg); }
  50% { transform: translateX(2px) rotate(5deg); }
  75% { transform: translateX(-1px) rotate(-3deg); }
  100% { transform: translateX(0) rotate(0deg); }
}

.flower.sway {
  animation: sway 2s ease-in-out infinite;
}

#result-box {
  position: absolute;
  left: 60px;
  top: 22%;
  transform: translateY(-50%);
  width: 250px;
  color: #d1d9e8;
}

#result-box .box {
  background: rgba(255,255,255,0.07);
  padding: 15px;
  border-radius: 5px;
  font-size: 0.85rem;
  text-align: left;
}

.item { margin-bottom: 6px; }
.ability { color:#9eb7ff; font-weight:bold; }

#final-message {
  color: #ff4d9e;
  font-size: 1rem;
  position: absolute;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  text-align: center;
  transition: opacity 2s ease-in-out;
  width: 100%;
}

#showResults, #restartBtn {
  position: absolute;
  bottom: 40px;
  padding: 10px 20px;
  background: #222;
  color: #ff4d9e;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1rem;
}

#showResults { left: 55%; transform: translateX(-50%);}
#restartBtn { left: 47%; transform: translateX(-50%); }

.lesson-text {
  position: absolute;
  padding: 8px 12px;
  border-radius: 100px;
  color: #ff85b3; 
  font-size: 0.9rem;
  font-weight: 350;
  pointer-events: none;
  opacity: 0;
  max-width: 280px; 
  word-wrap: break-word;
  text-align: center;

  background: rgba(255, 255, 255, 0.15);
  border: 0.1px solid #ff85b3;
  box-shadow: 0 0 3px rgba(255, 77, 158, 0.5);
}

.spark {
  position: fixed;
  width: 6px;
  height: 6px;
  background: radial-gradient(circle, #ff4d9e, #ff85b3);
  border-radius: 50%;
  pointer-events: none;
  opacity: 1;
  transform: translate(-50%, -50%);
  animation: spark-fade 0.6s ease-out forwards;
  box-shadow: 0 0 6px #ff4d9e;
}

@keyframes spark-fade {
  0% { opacity: 1; transform: scale(1) translate(-50%, -50%); }
  100% { opacity: 0; transform: scale(0.4) translate(-50%, -50%); }
}
</style>
</head>
<body>

<div id="tree-container">
  <h1 id="title">ë‹¹ì‹ ì˜ ë„ì›€ìœ¼ë¡œ ì˜ë¢°ì¸ì€ ë‚˜ë¬´ì˜ ê½ƒì„ í”¼ì›ŒëƒˆìŠµë‹ˆë‹¤.</h1>
  <p id="subtitle">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì™¸ë¢° ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”</p>
  <div id="flower-layer"></div>
</div>

<div id="result-box">
  <div class="box">
    <div class="item">ë‹¹ì‹ ì´ íšë“í•œ ëŠ¥ë ¥:</div>
    <div class="item box-content"><span id="ability-list"></span></div>
    <div class="item">ì„±ê³µ ê²½í—˜ <span id="wins"></span></div>
    <div class="item">ì‹¤íŒ¨ ê²½í—˜ <span id="losses"></span></div>
    <div class="item" style="margin-top:10px;"></div>
    <div id="log" class="box-content"></div>
  </div>
</div>

<div id="final-message"></div>

<button id="showResults">ê²°ê³¼ ë³´ê¸°</button>
<button id="restartBtn" onclick="window.location.href='index3.html'">ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘</button>

<script>
// ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
const data = JSON.parse(localStorage.getItem("gameResult"));
if (!data) {
  alert("ê²°ê³¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²Œì„ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.");
  window.location.href = "index.html";
}

// ëŠ¥ë ¥ êµí›ˆ
const lessons = {
  "ìš©ê¸°": "ì–´ë µê³  ë¬´ì„œìš´ ìƒí™©ì—ì„œ ì£¼ì €í•˜ì§€ ì•Šê³ <br>ë„ì „í•  ìš©ê¸°ê°€ ë‚˜ë¬´ë¥¼ ì„±ì¥ì‹œì¼°ìŠµë‹ˆë‹¤",
  "ì§€í˜œ": "ì§€í˜œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì–´ë ¤ìš´ ìƒí™© ì†ì—ì„œë„<br>ë‚˜ë¬´ê°€ ì„±ì¥í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤",
  "ì°½ì˜ë ¥": "ë‹¹ì‹ ì€ ì°½ì˜ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ë¥¸<br>ì‚¬ëŒë“¤ê³¼ ë‹¤ë¥¸ ì‹œì„ ì„ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤",
  "ì¸ë‚´": "ì¸ë‚´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‚˜ë¬´ê°€ ìë¼ëŠ” ê³¼ì •ì„<br>ê¾¸ì¤€íˆ ì§€ì¼œë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤",
  "ì—´ì •": "ë§¤ì¼ ì—´ì •ì„ ê°€ì§€ê³  ë‚˜ë¬´ë¥¼ ëŒë´<br>ê½ƒì„ í”¼ì›Œë‚´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤",
  "ì‹¤íŒ¨": "ì„±ê³µë§Œì´ ë‚˜ë¬´ë¥¼ ì„±ì¥ì‹œí‚¤ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤<br>ì‹¤íŒ¨ê°€ ê±°ë¦„ì´ ë˜ì–´ ë‚˜ë¬´ê°€ ì„±ì¥ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤",
  "ì‹œê°„ ì´ˆê³¼": "í¬ê¸°í•˜ì§€ ì•ŠëŠ” ëˆê¸°ë¥¼ ë°”íƒ•ìœ¼ë¡œ<br>ë‚˜ë¬´ê°€ ì„±ì¥í–ˆìŠµë‹ˆë‹¤"
};

// ê²°ê³¼ í‘œì‹œ
document.getElementById("ability-list").textContent = data.abilities.join(", ");
document.getElementById("wins").textContent = data.wins;
document.getElementById("losses").textContent = data.losses;

const logEl = document.getElementById("log");

// ê½ƒì ìƒì„±
function createFlowers(count=80) {
  const container = document.getElementById("flower-layer");
  const centerX = container.offsetWidth / 2;
  const centerY = container.offsetHeight / 2.5;
  const radiusX = container.offsetWidth * 0.6;
  const radiusY = container.offsetHeight * 0.25;

  for(let i=0; i<count; i++) {
    const flower = document.createElement("div");
    flower.classList.add("flower");
    flower.style.background = Math.random() < 0.5 ? "#FFB6C1" : "#FF7DAF";

    const r = Math.sqrt(Math.random()) * (0.7 + Math.random() * 0.4); 
    const theta = Math.random() * 2 * Math.PI + (Math.random() - 0.5) * 0.2; 
    const offsetX = (Math.random() - 0.5) * 30; 
    const offsetY = (Math.random() - 0.5) * 30;
    const x = centerX + radiusX * r * Math.cos(theta) + offsetX;
    const y = centerY + radiusY * r * Math.sin(theta) + offsetY;

    flower.style.left = `${x}px`;
    flower.style.top = `${y}px`;

    const size = 3 + Math.random() * 3;
    flower.style.width = `${size}px`;
    flower.style.height = `${size}px`;

    const rotateX = Math.random()*360;
    const rotateY = Math.random()*360;
    const rotateZ = Math.random()*360;
    flower.style.transform = `scale(0) rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg)`;
    container.appendChild(flower);

    setTimeout(() => {
      flower.style.transition = `opacity 0.8s ease-out, transform 0.9s cubic-bezier(.2,.9,.2,1)`;
      flower.style.opacity = 1;
      flower.style.transform = `scale(1) rotateX(${rotateX}deg) rotateY(${rotateY}deg) rotateZ(${rotateZ}deg)`;
    }, 50 + Math.random()*400);
  }
}

// ì›í˜• ìœ„ì¹˜ ê³„ì‚°
function getCircularPosition(index, total, radiusX=550, radiusY=250) {
    const container = document.getElementById("tree-container");
    const centerX = container.offsetLeft + container.offsetWidth / 2;
    const centerY = container.offsetTop + container.offsetHeight / 2;

    const angle = (2 * Math.PI / total) * index;
    const offsetX = (Math.random() - 0.5) * 40; 
    const offsetY = (Math.random() - 0.5) * 30;

    const x = centerX + radiusX * Math.cos(angle) + offsetX;
    const y = centerY + radiusY * Math.sin(angle) + offsetY;

    return { x, y };
}

// ===== results ë°°ì—´ ìƒì„± =====
const lessonsKeys = ["ìš©ê¸°", "ì§€í˜œ", "ì°½ì˜ë ¥", "ì¸ë‚´", "ì—´ì •", "ì‹¤íŒ¨", "ì‹œê°„ ì´ˆê³¼"];
const results = [];

data.abilities.forEach(ability => {
  if (lessonsKeys.includes(ability)) results.push(ability);
});

if(data.losses > 0 && !results.includes("ì‹¤íŒ¨")) results.push("ì‹¤íŒ¨");
if(data.timeouts > 0 && !results.includes("ì‹œê°„ ì´ˆê³¼")) results.push("ì‹œê°„ ì´ˆê³¼");

while(results.length < 7){
  results.push("ì‹¤íŒ¨"); 
}

results.forEach(item => {
  const div = document.createElement("div");
  div.textContent = item;
  div.style.opacity = 0;
  logEl.appendChild(div);
});

let currentIndex = 0;

function showFinalMessage(text){
    const titleEl = document.getElementById("title");
    titleEl.textContent = "";
    
    const lines = text.split("\n");
    
    lines.forEach(line => {
        const span = document.createElement("span");
        span.textContent = "";
        titleEl.appendChild(span);
    });

    let lineIndex = 0;
    let charIndex = 0;

    function typeWriterFinal() {
        if(lineIndex < lines.length){
            const span = titleEl.children[lineIndex];
            if(charIndex < lines[lineIndex].length){
                span.textContent += lines[lineIndex].charAt(charIndex);
                charIndex++;
                setTimeout(typeWriterFinal, 80);
            } else {
                lineIndex++;
                charIndex = 0;
                setTimeout(typeWriterFinal, 80);
            }
        }
    }

    typeWriterFinal();
}



document.getElementById("showResults").addEventListener("click", () => {
  const logChildren = Array.from(logEl.children);
  if (currentIndex >= logChildren.length) {
    document.getElementById("subtitle").style.display = "none";

    const finalText =
"ì˜ë¢°ì¸ì²˜ëŸ¼ ë‹¹ì‹ ë„ ì™„ë²½í•œ ì„±ê³µë§Œì„ ì¶”êµ¬í•˜ë‚˜ìš”?\ní•˜ì§€ë§Œ ì˜ë¢°ì¸ì˜ ê½ƒì„ í”¼ìš´ ê±´ ì‹¤íŒ¨ì™€ ì„±ê³µ ëª¨ë“  ê²½í—˜ì´ì—ˆìŠµë‹ˆë‹¤";

    showFinalMessage(finalText);
    return;
  }

  const div = logChildren[currentIndex];
  div.style.transition = "opacity 0.6s";
  div.style.opacity = 1;

  createFlowers(400);

  let key = div.textContent.split(" ")[0]; 
  let content = data.abilities.includes(key) ? lessons[key] : lessons[key.includes("ì‹œê°„") ? "ì‹œê°„ ì´ˆê³¼" : "ì‹¤íŒ¨"];

  const lessonDiv = document.createElement("div");
  lessonDiv.classList.add("lesson-text");
  lessonDiv.innerHTML = content;
  document.body.appendChild(lessonDiv);

  const pos = getCircularPosition(currentIndex, logChildren.length);
  lessonDiv.style.left = `${pos.x - lessonDiv.offsetWidth/2}px`;
  lessonDiv.style.top = `${pos.y - lessonDiv.offsetHeight/2}px`;

  setTimeout(() => { 
      lessonDiv.style.transition = "opacity 1s"; 
      lessonDiv.style.opacity = 1; 
  }, 50);

  currentIndex++;
});
</script>

</body>
</html>
